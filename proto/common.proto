syntax = "proto3";

option go_package = "github.com/kamalyes/go-rpc-gateway/pbuf/commonapis";
option java_package = "com.github.kamalyes.commonapis.api";

import "google/protobuf/timestamp.proto";

// 公共状态码.
// [EN] Common status code.
enum StatusCode {
  // 成功返回.
  // [EN] OK is returned on success.
  OK = 0;

  // 操作被取消（通常由调用方取消）.
  //
  // 当请求取消时，gRPC框架将生成此错误码.
  // [EN] Canceled indicates the operation was canceled (typically by the caller).
  //
  // The gRPC framework will generate this error code when cancellation
  // is requested.
  Canceled = 1;

  // 未知错误. 例如，如果从另一个地址空间接收到的Status值属于
  // 此地址空间中未知的错误空间时，可能会返回此错误. 
  // 由于没有返回足够错误信息的API引发的错误也可能被转换为此错误.
  //
  // gRPC框架将在上述两种情况下生成此错误码.
  // [EN] Unknown error. An example of where this error may be returned is
  // if a Status value received from another address space belongs to
  // an error-space that is not known in this address space. Also
  // errors raised by APIs that do not return enough error information
  // may be converted to this error.
  //
  // The gRPC framework will generate this error code in the above two
  // mentioned cases.
  Unknown = 2;

  // 无效参数，表示客户端指定了无效的参数.
  // 请注意，这与FailedPrecondition不同. 它表示无论系统状态如何
  // 都有问题的参数（例如，格式错误的文件名）.
  //
  // gRPC框架不会生成此错误码.
  // [EN] InvalidArgument indicates client specified an invalid argument.
  // Note that this differs from FailedPrecondition. It indicates arguments
  // that are problematic regardless of the state of the system
  // (e.g., a malformed file name).
  //
  // This error code will not be generated by the gRPC framework.
  InvalidArgument = 3;

  // 截止时间超时，表示操作在完成之前已过期.
  // 对于改变系统状态的操作，即使操作已成功完成，
  // 也可能返回此错误. 例如，来自服务器的成功响应可能
  // 被延迟得足够长，以至于截止时间过期.
  //
  // 当截止时间超过时，gRPC框架将生成此错误码.
  // [EN] DeadlineExceeded means operation expired before completion.
  // For operations that change the state of the system, this error may be
  // returned even if the operation has completed successfully. For
  // example, a successful response from a server could have been delayed
  // long enough for the deadline to expire.
  //
  // The gRPC framework will generate this error code when the deadline is
  // exceeded.
  DeadlineExceeded = 4;

  // 未找到，表示某些请求的实体（例如，文件或目录）未找到.
  //
  // gRPC框架不会生成此错误码.
  // [EN] NotFound means some requested entity (e.g., file or directory) was
  // not found.
  //
  // This error code will not be generated by the gRPC framework.
  NotFound = 5;

  // 已存在，表示尝试创建实体失败，因为已经存在.
  //
  // gRPC框架不会生成此错误码.
  // [EN] AlreadyExists means an attempt to create an entity failed because one
  // already exists.
  //
  // This error code will not be generated by the gRPC framework.
  AlreadyExists = 6;

  // 权限拒绝，表示调用者没有权限执行指定的操作.
  // 不能用于由于资源耗尽而引起的拒绝（对于这些错误请使用ResourceExhausted）.
  // 如果无法识别调用者，则不能使用此代码（对于这些错误请使用Unauthenticated）.
  //
  // gRPC核心框架不会生成此错误码，但期望身份验证中间件使用它.
  // [EN] PermissionDenied indicates the caller does not have permission to
  // execute the specified operation. It must not be used for rejections
  // caused by exhausting some resource (use ResourceExhausted
  // instead for those errors). It must not be
  // used if the caller cannot be identified (use Unauthenticated
  // instead for those errors).
  //
  // This error code will not be generated by the gRPC core framework,
  // but expect authentication middleware to use it.
  PermissionDenied = 7;

  // 资源耗尽，表示某些资源已用尽，可能是每用户配额，
  // 或者整个文件系统空间不足.
  //
  // 在内存不足和服务器过载情况下，或者当消息大于配置的最大大小时，
  // gRPC框架将生成此错误码.
  // [EN] ResourceExhausted indicates some resource has been exhausted, perhaps
  // a per-user quota, or perhaps the entire file system is out of space.
  //
  // This error code will be generated by the gRPC framework in
  // out-of-memory and server overload situations, or when a message is
  // larger than the configured maximum size.
  ResourceExhausted = 8;

  // 前提条件失败，表示操作被拒绝，因为系统不处于操作执行所需的状态.
  // 例如，要删除的目录可能为非空，rmdir操作应用于非目录等.
  //
  // 以下测试可能有助于服务实施者在FailedPrecondition、Aborted和Unavailable之间做出决定：
  //  (a) 如果客户端可以重试失败的调用，请使用Unavailable.
  //  (b) 如果客户端应该在更高级别重试（例如，重新启动读-修改-写序列），请使用Aborted.
  //  (c) 如果在系统状态明确修复之前客户端不应重试，请使用FailedPrecondition.
  //      例如，如果"rmdir"因为目录非空而失败，应该返回FailedPrecondition，
  //      因为客户端不应重试，除非他们首先通过删除目录中的文件来修复目录.
  //  (d) 如果客户端对资源执行条件REST Get/Update/Delete，
  //      而服务器上的资源不匹配条件，请使用FailedPrecondition.
  //      例如，对同一资源进行冲突的读-修改-写操作.
  //
  // gRPC框架不会生成此错误码.
  // [EN] FailedPrecondition indicates operation was rejected because the
  // system is not in a state required for the operation's execution.
  // For example, directory to be deleted may be non-empty, an rmdir
  // operation is applied to a non-directory, etc.
  //
  // A litmus test that may help a service implementor in deciding
  // between FailedPrecondition, Aborted, and Unavailable:
  //  (a) Use Unavailable if the client can retry just the failing call.
  //  (b) Use Aborted if the client should retry at a higher-level
  //      (e.g., restarting a read-modify-write sequence).
  //  (c) Use FailedPrecondition if the client should not retry until
  //      the system state has been explicitly fixed. E.g., if an "rmdir"
  //      fails because the directory is non-empty, FailedPrecondition
  //      should be returned since the client should not retry unless
  //      they have first fixed up the directory by deleting files from it.
  //  (d) Use FailedPrecondition if the client performs conditional
  //      REST Get/Update/Delete on a resource and the resource on the
  //      server does not match the condition. E.g., conflicting
  //      read-modify-write on the same resource.
  //
  // This error code will not be generated by the gRPC framework.
  FailedPrecondition = 9;

  // 中止，表示操作被中止，通常是由于并发问题，
  // 如序列检查失败、事务中止等.
  //
  // 有关在FailedPrecondition、Aborted和Unavailable之间决策的测试，请参见上文.
  //
  // gRPC框架不会生成此错误码.
  // [EN] Aborted indicates the operation was aborted, typically due to a
  // concurrency issue like sequencer check failures, transaction aborts,
  // etc.
  //
  // See litmus test above for deciding between FailedPrecondition,
  // Aborted, and Unavailable.
  //
  // This error code will not be generated by the gRPC framework.
  Aborted = 10;

  // 超出范围，表示尝试的操作超出了有效范围.
  // 例如，寻找或读取超出文件末尾.
  //
  // 与InvalidArgument不同，此错误表示如果系统状态改变可能会修复的问题.
  // 例如，32位文件系统在被要求读取不在[0,2^32-1]范围内的偏移量时会生成InvalidArgument，
  // 但如果被要求读取超出当前文件大小的偏移量会生成OutOfRange.
  //
  // FailedPrecondition和OutOfRange之间有相当大的重叠.
  // 我们建议在适用时使用OutOfRange（更具体的错误），
  // 以便在空间中迭代的调用者可以轻松寻找OutOfRange错误来检测何时完成.
  //
  // gRPC框架不会生成此错误码.
  // [EN] OutOfRange means operation was attempted past the valid range.
  // E.g., seeking or reading past end of file.
  //
  // Unlike InvalidArgument, this error indicates a problem that may
  // be fixed if the system state changes. For example, a 32-bit file
  // system will generate InvalidArgument if asked to read at an
  // offset that is not in the range [0,2^32-1], but it will generate
  // OutOfRange if asked to read from an offset past the current
  // file size.
  //
  // There is a fair bit of overlap between FailedPrecondition and
  // OutOfRange. We recommend using OutOfRange (the more specific
  // error) when it applies so that callers who are iterating through
  // a space can easily look for an OutOfRange error to detect when
  // they are done.
  //
  // This error code will not be generated by the gRPC framework.
  OutOfRange = 11;

  // 未实现，表示操作未实现或在此服务中未支持/启用.
  //
  // gRPC框架将生成此错误码. 最常见的情况是，
  // 当服务器上缺少方法实现时，您会看到此错误码.
  // 也可能由于未知的压缩算法或关于RPC是否应该是流式的分歧而生成.
  // [EN] Unimplemented indicates operation is not implemented or not
  // supported/enabled in this service.
  //
  // This error code will be generated by the gRPC framework. Most
  // commonly, you will see this error code when a method implementation
  // is missing on the server. It can also be generated for unknown
  // compression algorithms or a disagreement as to whether an RPC should
  // be streaming.
  Unimplemented = 12;

  // 内部错误. 表示底层系统预期的某些不变量已被破坏.
  // 如果您看到这些错误之一，说明某些东西严重损坏.
  //
  // gRPC框架将在几种内部错误情况下生成此错误码.
  // [EN] Internal errors. Means some invariants expected by underlying
  // system has been broken. If you see one of these errors,
  // something is very broken.
  //
  // This error code will be generated by the gRPC framework in several
  // internal error conditions.
  Internal = 13;

  // 不可用，表示服务当前不可用.
  // 这很可能是一个暂时的情况，可以通过退避重试来纠正.
  // 请注意，重试非幂等操作并不总是安全的.
  //
  // 有关在FailedPrecondition、Aborted和Unavailable之间决策的测试，请参见上文.
  //
  // 在服务器进程或网络连接突然关闭期间，gRPC框架将生成此错误码.
  // [EN] Unavailable indicates the service is currently unavailable.
  // This is a most likely a transient condition and may be corrected
  // by retrying with a backoff. Note that it is not always safe to retry
  // non-idempotent operations.
  //
  // See litmus test above for deciding between FailedPrecondition,
  // Aborted, and Unavailable.
  //
  // This error code will be generated by the gRPC framework during
  // abrupt shutdown of a server process or network connection.
  Unavailable = 14;

  // 数据丢失，表示不可恢复的数据丢失或损坏.
  //
  // gRPC框架不会生成此错误码.
  // [EN] DataLoss indicates unrecoverable data loss or corruption.
  //
  // This error code will not be generated by the gRPC framework.
  DataLoss = 15;

  // 未认证，表示请求没有用于操作的有效身份验证凭据.
  //
  // 当身份验证元数据无效或Credentials回调失败时，
  // gRPC框架将生成此错误码，但也期望身份验证中间件生成此错误码.
  // [EN] Unauthenticated indicates the request does not have valid
  // authentication credentials for the operation.
  //
  // The gRPC framework will generate this error code when the
  // authentication metadata is invalid or a Credentials callback fails,
  // but also expect authentication middleware to generate it.
  Unauthenticated = 16;

  // 保留供内部使用.
  // [EN] reserved for internal use.

  reserved 17 to 100;

  // 通用系统错误.

  // 未知系统错误.
  // [EN] Unknown system error.
  SYSTEM_UNKNOWN_ERROR = 101;
  // 网络错误.
  // [EN] Network error.
  SYSTEM_NETWORK_ERROR = 102;
  // 存储系统错误.
  // [EN] Storage system error.
  SYSTEM_STORAGE_ERROR = 103;
  reserved 104 to 200;
}

// 通用处理结果返回. 通常在Batch类请求中返回每个子请求的错误状态.
// [EN] General processing results returned. Error status of each sub-request is
// usually returned in Batch mode requests.
message Result {
  // 通用服务、系统错误码, 对应HTTP错误及语义见系统标准错误表.
  // 若为业务特定错误, code应返回0, 详情见status及对应错误.
  // [EN] For common service and system error codes, see the system standard
  // error table corresponding HTTP errors and semantics. For business-specific
  // errors, code will return 0. For details, see status and corresponding
  // errors.
  int32 code = 1;
  // 错误详细描述.
  // [EN] Detailed description of the error.
  string error = 2;
  // 业务错误码.
  // [EN] Business error code.
  StatusCode status = 3;
}

// 通用翻页结构.
// [EN] Common paging structure.
message Paging {
  // 可选, 取值:>=0, 默认值为1.
  // [EN] Optional, start page, value: > = 0, the default value is 1.
  int32 page = 1;
  // 数量, 默认取值范围[1,100], 如果超出范围, 则返回失败.
  // [EN] Size, default value range [1,100], if it is out of the range, error
  // will be returned.
  int32 size = 2;
  // 可选, 请求无须填此参数, 响应时系统填写.
  // [EN] Optional, this parameter is not required for request, but will be
  // filled in response.
  int32 total = 3;
}

// 通用排序结构.
// [EN] Common sorting structure.
message Sorting {
  // 排序字段, 接口对应字段, 由对应接口解析.
  // [EN] Sort field, the corresponding field of the interface, which is parsed
  // by the corresponding interface.
  string field = 1;
  // 可选, 是否倒序
  // [EN] Optional: Reverse order or not
  bool reversed = 2;
}

// TimeRange表示一段时间区间 [start, end) , 时间戳为UTC时间.
// 时间戳JSON表示形式为RFC 3339格式, 如: "1972-01-01T10:00:20.021Z".
// [EN] TimeRange, represents a period of time interval [start, end), which the
// timestamp is UTC time. The representation of JSON timestamp is RFC3339
// format, such as: “1972-01-01T10:00:20.021Z”.
message TimeRange {
  // 开始时间, 区间包含.
  // [EN] Start time, interval inclusive.
  google.protobuf.Timestamp start = 1;
  // 结束时间, 区间不包含.
  // [EN] End time, interval exclusive.
  google.protobuf.Timestamp end = 2;
}