# ğŸ—ï¸ Go RPC Gateway æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº† go-rpc-gateway æ¡†æ¶çš„æ¶æ„è®¾è®¡ã€ç»„ä»¶å…³ç³»å’Œæ•°æ®æµå‘ï¼Œå¸®åŠ©å¼€å‘è€…æ·±å…¥ç†è§£æ¡†æ¶çš„å·¥ä½œåŸç†å’Œæ‰©å±•æœºåˆ¶ã€‚

## ğŸ¯ è®¾è®¡ç†å¿µ

### æ ¸å¿ƒåŸåˆ™

1. **ğŸ”§ æ¨¡å—åŒ–è®¾è®¡** - æ¾è€¦åˆã€é«˜å†…èšçš„ç»„ä»¶æ¶æ„
2. **âš™ï¸ é…ç½®é©±åŠ¨** - é€šè¿‡é…ç½®æ§åˆ¶è¡Œä¸ºï¼Œå‡å°‘ç¡¬ç¼–ç 
3. **ğŸ”Œ ä¸­é—´ä»¶æ¶æ„** - ç®¡é“å¼å¤„ç†ï¼Œæ”¯æŒæ’æ‹”å¼æ‰©å±•
4. **ğŸ” å¯è§‚æµ‹æ€§** - å†…ç½®ç›‘æ§ã€æ—¥å¿—ã€è¿½è¸ªèƒ½åŠ›
5. **ğŸ“¦ ç±»å‹å®‰å…¨** - åŸºäº Protocol Buffers çš„å¼ºç±»å‹ç³»ç»Ÿ

### æŠ€æœ¯é€‰å‹

| ç»„ä»¶ | æŠ€æœ¯é€‰æ‹© | åŸå›  |
|------|----------|------|
| **é…ç½®ç®¡ç†** | go-config | ç»Ÿä¸€é…ç½®æ¥å£ï¼Œæ”¯æŒå¤šç§æ•°æ®æº |
| **æ ¸å¿ƒç»„ä»¶** | go-core | ä¼ä¸šçº§ç»„ä»¶é›†æˆï¼ˆæ•°æ®åº“ã€ç¼“å­˜ç­‰ï¼‰|
| **Webæ¡†æ¶** | åŸç”Ÿ net/http | è½»é‡çº§ï¼Œæ€§èƒ½ä¼˜ç§€ |
| **RPCæ¡†æ¶** | gRPC | é«˜æ€§èƒ½ï¼Œè·¨è¯­è¨€æ”¯æŒ |
| **ç½‘å…³åè®®** | grpc-gateway | HTTP/gRPC åè®®è½¬æ¢ |
| **æ—¥å¿—ç³»ç»Ÿ** | Zap | é«˜æ€§èƒ½ç»“æ„åŒ–æ—¥å¿— |
| **ç›‘æ§æŒ‡æ ‡** | Prometheus | äº‘åŸç”Ÿæ ‡å‡†ç›‘æ§ |
| **é“¾è·¯è¿½è¸ª** | OpenTelemetry | åˆ†å¸ƒå¼è¿½è¸ªæ ‡å‡† |

## ğŸ›ï¸ æ•´ä½“æ¶æ„

### æ¶æ„åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ğŸŒ å®¢æˆ·ç«¯è®¿é—®å±‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  HTTP Client          â”‚          gRPC Client          â”‚    ç®¡ç†ç«¯è®¿é—®        â”‚
â”‚  Web Browser          â”‚      Backend Services         â”‚   Health/Metrics    â”‚
â”‚  Mobile App           â”‚         gRPCurl              â”‚     PProf Debug     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ğŸšª åè®®ç½‘å…³å±‚                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ HTTP Server â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ gRPC Server â”‚                â”‚
â”‚  â”‚ (:8080)     â”‚         gRPC-Gateway        â”‚ (:9090)     â”‚                â”‚
â”‚  â”‚             â”‚        Protocol Bridge      â”‚             â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ğŸ›¡ï¸ ä¸­é—´ä»¶å¤„ç†å±‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ Security â”‚ â”‚RateLimit â”‚ â”‚ Logging  â”‚ â”‚ Metrics  â”‚ â”‚   i18n   â”‚ â”‚ Health  â”‚â”‚
â”‚ â”‚   CORS   â”‚ â”‚TokenBucketâ”‚ â”‚ZapLogger â”‚ â”‚Prometheusâ”‚ â”‚19 Langs  â”‚ â”‚ Check   â”‚â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚Signature â”‚ â”‚ Recovery â”‚ â”‚RequestID â”‚ â”‚ Tracing  â”‚ â”‚ Access   â”‚ â”‚  PProf  â”‚â”‚
â”‚ â”‚HMAC-SHA256â”‚ â”‚PanicSafe â”‚ â”‚UUIDTrack â”‚ â”‚OpenTelem â”‚ â”‚ Logging  â”‚ â”‚ Profile â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ğŸ’¼ ä¸šåŠ¡æœåŠ¡å±‚                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ User Serviceâ”‚  â”‚Order Serviceâ”‚  â”‚ Pay Service â”‚  â”‚ ... Service â”‚         â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚         â”‚
â”‚  â”‚ - GetUser   â”‚  â”‚ - CreateOrderâ”‚  â”‚ - Payment   â”‚  â”‚ - Custom    â”‚         â”‚
â”‚  â”‚ - UpdateUserâ”‚  â”‚ - GetOrder  â”‚  â”‚ - Refund    â”‚  â”‚   Business  â”‚         â”‚
â”‚  â”‚ - DeleteUserâ”‚  â”‚ - ListOrder â”‚  â”‚ - Query     â”‚  â”‚   Logic     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ğŸ’¾ æ ¸å¿ƒç»„ä»¶å±‚ (go-core é›†æˆ)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚   Database   â”‚    Redis     â”‚    MinIO     â”‚   RabbitMQ   â”‚   Consul    â”‚ â”‚
â”‚ â”‚ MySQL/Postgresâ”‚   Cache     â”‚Object Storageâ”‚Message Queue â”‚Service Mesh â”‚ â”‚
â”‚ â”‚              â”‚              â”‚              â”‚              â”‚             â”‚ â”‚
â”‚ â”‚ - GORM ORM   â”‚ - go-redis   â”‚ - S3 API     â”‚ - AMQP åè®®   â”‚ - æœåŠ¡å‘ç°   â”‚ â”‚
â”‚ â”‚ - è¿æ¥æ±      â”‚ - é›†ç¾¤æ”¯æŒ   â”‚ - åˆ†ç‰‡ä¸Šä¼    â”‚ - å¯é æŠ•é€’   â”‚ - é…ç½®ä¸­å¿ƒ   â”‚ â”‚
â”‚ â”‚ - äº‹åŠ¡æ”¯æŒ   â”‚ - æŒä¹…åŒ–     â”‚ - CDN åŠ é€Ÿ   â”‚ - æ­»ä¿¡é˜Ÿåˆ—   â”‚ - å¥åº·æ£€æŸ¥   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 1. Gateway å…¥å£å±‚

```go
// Gateway æ˜¯æ¡†æ¶çš„æ ¸å¿ƒå…¥å£
type Gateway struct {
    *server.Server           // åµŒå…¥æœåŠ¡å™¨æ ¸å¿ƒ
    pprofEnabled     bool    // pprof å¼€å…³
    pprofConfig      *register.PProf
    pprofAdapter     *middleware.PProfConfigAdapter
    pprofGatewayConfig *middleware.PProfGatewayConfig
}
```

**èŒè´£ï¼š**

- ğŸ¯ æä¾›ç»Ÿä¸€çš„åˆ›å»ºå…¥å£
- ğŸ”§ æ•´åˆé…ç½®ç®¡ç†å’ŒæœåŠ¡å™¨æ ¸å¿ƒ
- ğŸ”Œ é›†æˆæ€§èƒ½åˆ†æå·¥å…·
- ğŸ“‹ æš´éœ²ç®€æ´çš„ç”¨æˆ·API

### 2. Server æ ¸å¿ƒå±‚

```go
type Server struct {
    config        *config.GatewayConfig    // ç½‘å…³é…ç½®
    configManager *config.ConfigManager    // é…ç½®ç®¡ç†å™¨
    
    // æœåŠ¡å™¨ç»„ä»¶
    grpcServer *grpc.Server               // gRPC æœåŠ¡å™¨
    httpServer *http.Server               // HTTP æœåŠ¡å™¨  
    gwMux      *runtime.ServeMux          // ç½‘å…³è·¯ç”±å™¨
    httpMux    *http.ServeMux            // HTTP è·¯ç”±å™¨
    
    // ç®¡ç†ç»„ä»¶
    middlewareManager *middleware.Manager  // ä¸­é—´ä»¶ç®¡ç†å™¨
    healthManager     *middleware.HealthManager // å¥åº·æ£€æŸ¥
    bannerManager     *BannerManager       // å¯åŠ¨æ¨ªå¹…
    
    // ç”Ÿå‘½å‘¨æœŸç®¡ç†
    ctx    context.Context               // ä¸Šä¸‹æ–‡
    cancel context.CancelFunc            // å–æ¶ˆå‡½æ•°
    wg     sync.WaitGroup               // ç­‰å¾…ç»„
}
```

**æ ¸å¿ƒæ–¹æ³•ï¼š**

- `NewServer()` - åˆ›å»ºæœåŠ¡å™¨å®ä¾‹
- `RegisterGRPCService()` - æ³¨å†ŒgRPCæœåŠ¡
- `RegisterHTTPHandler()` - æ³¨å†ŒHTTPå¤„ç†å™¨
- `Start()` - å¯åŠ¨æœåŠ¡å™¨
- `Shutdown()` - ä¼˜é›…å…³é—­

### 3. é…ç½®ç®¡ç†å±‚

#### é…ç½®ç»“æ„å±‚æ¬¡

```go
type GatewayConfig struct {
    // åŸºç¡€é…ç½® (ç»§æ‰¿ go-config)
    *goconfig.SingleConfig `mapstructure:",squash"`
    
    // Gateway ç‰¹æœ‰é…ç½®
    Gateway    GatewaySettings  `mapstructure:"gateway"`
    Middleware MiddlewareConfig `mapstructure:"middleware"`  
    Monitoring MonitoringConfig `mapstructure:"monitoring"`
    Security   SecurityConfig   `mapstructure:"security"`
}
```

#### é…ç½®æ–‡ä»¶ç¤ºä¾‹

```yaml
# config.yaml
server:
  name: go-rpc-gateway
  version: v1.0.0
  environment: production

gateway:
  name: go-rpc-gateway
  debug: false
  http:
    host: 0.0.0.0
    port: 8080
    read_timeout: 30
    write_timeout: 30
  grpc:
    host: 0.0.0.0
    port: 9090
    enable_reflection: true

middleware:
  rate_limit:
    enabled: true
    algorithm: token_bucket
    rate: 1000
    burst: 100
  access_log:
    enabled: true
    format: json
  signature:
    enabled: false
    algorithm: hmac-sha256
    secret_key: "your-secret-key"

monitoring:
  metrics:
    enabled: true
    path: /metrics
    port: 8081
  tracing:
    enabled: true
    endpoint: "http://jaeger:14268/api/traces"
  pprof:
    enabled: true
    path_prefix: /debug/pprof
    allowed_ips: ["127.0.0.1", "::1"]

security:
  cors:
    enabled: true
    allowed_origins: ["*"]
    allowed_methods: ["GET", "POST", "PUT", "DELETE"]
    allowed_headers: ["*"]
```

### 4. ä¸­é—´ä»¶ç³»ç»Ÿ

#### ä¸­é—´ä»¶ç®¡ç†å™¨

```go
type Manager struct {
    metricsManager      *MetricsManager      // æŒ‡æ ‡ç®¡ç†
    tracingManager      *TracingManager      // é“¾è·¯è¿½è¸ª
    loggingConfig       *LoggingConfig       // æ—¥å¿—é…ç½®
    corsConfig          *cors.Cors           // è·¨åŸŸé…ç½®
    rateLimitConfig     *RateLimitConfig     // é™æµé…ç½®
    accessRecordConfig  *AccessRecordConfig  // è®¿é—®è®°å½•
    signatureConfig     *SignatureConfig     // ç­¾åéªŒè¯
    pprofConfig         *register.PProf      // æ€§èƒ½åˆ†æ
    i18nConfig          *I18nConfig          // å›½é™…åŒ–
    
    // å…·ä½“å®ç°
    rateLimiter         RateLimiter          // é™æµå™¨
    accessRecordHandler AccessRecordHandler  // è®¿é—®è®°å½•å¤„ç†å™¨
    signatureValidator  SignatureValidator   // ç­¾åéªŒè¯å™¨
    i18nManager         *I18nManager         // å›½é™…åŒ–ç®¡ç†å™¨
}
```

#### ä¸­é—´ä»¶åˆ†ç±»

| åˆ†ç±» | ä¸­é—´ä»¶ | æ ¸å¿ƒåŠŸèƒ½ | ä¾èµ–ç»„ä»¶ |
|------|--------|----------|----------|
| **ğŸ›¡ï¸ å®‰å…¨ç±»** | Security | å®‰å…¨å¤´ã€XSSé˜²æŠ¤ã€CSP | æ—  |
| | CORS | è·¨åŸŸèµ„æºå…±äº« | go-config/cors |
| | Signature | è¯·æ±‚ç­¾åéªŒè¯ | crypto/hmac |
| **ğŸ“Š ç›‘æ§ç±»** | Metrics | æŒ‡æ ‡é‡‡é›† | Prometheus |
| | Logging | ç»“æ„åŒ–æ—¥å¿— | Zap Logger |
| | Tracing | é“¾è·¯è¿½è¸ª | OpenTelemetry |
| | Health | å¥åº·æ£€æŸ¥ | Redis/MySQL |
| **ğŸš¦ æ§åˆ¶ç±»** | RateLimit | æµé‡æ§åˆ¶ | ä»¤ç‰Œæ¡¶ç®—æ³• |
| | Recovery | å¼‚å¸¸æ¢å¤ | æ—  |
| | RequestID | è¯·æ±‚è¿½è¸ª | UUID |
| **ğŸŒ ä½“éªŒç±»** | I18n | å›½é™…åŒ– | 19ç§è¯­è¨€åŒ… |
| | Access | è®¿é—®æ—¥å¿— | æ–‡ä»¶/æ•°æ®åº“ |
| **ğŸ”§ å¼€å‘ç±»** | PProf | æ€§èƒ½åˆ†æ | net/http/pprof |
| | Banner | å¯åŠ¨æ¨ªå¹… | é…ç½®æ¨¡æ¿ |

## ğŸ”„ æ•°æ®æµå‘åˆ†æ

### 1. HTTP è¯·æ±‚å¤„ç†æµç¨‹

```
HTTP Request
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚HTTP Server  â”‚ :8080
â”‚(net/http)   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Middleware   â”‚â”€â”€â”€â”€â–¶â”‚  Gateway    â”‚â”€â”€â”€â”€â–¶â”‚   gRPC      â”‚
â”‚Chain        â”‚     â”‚  Mux        â”‚     â”‚  Client     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                     â”‚                   â”‚
      â”‚                     â”‚                   â–¼
      â”‚                     â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                     â”‚            â”‚gRPC Server  â”‚ :9090
      â”‚                     â”‚            â”‚(grpc)       â”‚
      â”‚                     â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                     â”‚                   â”‚
      â”‚                     â”‚                   â–¼
      â”‚                     â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                     â”‚            â”‚Business     â”‚
      â”‚                     â”‚            â”‚Service      â”‚
      â”‚                     â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                     â”‚                   â”‚
      â”‚                     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                     â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
HTTP Response
```

### 2. ä¸­é—´ä»¶æ‰§è¡Œé“¾è·¯

```
Request In
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 1. å®‰å…¨æ£€æŸ¥
â”‚ Security    â”‚ â”œâ”€â”€ CORS éªŒè¯
â”‚ Middleware  â”‚ â”œâ”€â”€ XSS é˜²æŠ¤  
â”‚             â”‚ â””â”€â”€ CSP ç­–ç•¥
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 2. æµé‡æ§åˆ¶
â”‚ RateLimit   â”‚ â”œâ”€â”€ ä»¤ç‰Œæ¡¶ç®—æ³•
â”‚ Middleware  â”‚ â”œâ”€â”€ IP é™æµ
â”‚             â”‚ â””â”€â”€ ç”¨æˆ·é™æµ
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 3. è¯·æ±‚è¿½è¸ª
â”‚ RequestID   â”‚ â”œâ”€â”€ ç”Ÿæˆ UUID
â”‚ Middleware  â”‚ â”œâ”€â”€ æ³¨å…¥ Header
â”‚             â”‚ â””â”€â”€ ä¸Šä¸‹æ–‡ä¼ é€’
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 4. ç­¾åéªŒè¯
â”‚ Signature   â”‚ â”œâ”€â”€ HMAC-SHA256
â”‚ Middleware  â”‚ â”œâ”€â”€ æ—¶é—´æˆ³éªŒè¯
â”‚             â”‚ â””â”€â”€ Nonce é˜²é‡æ”¾
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 5. é“¾è·¯è¿½è¸ª
â”‚ Tracing     â”‚ â”œâ”€â”€ Span åˆ›å»º
â”‚ Middleware  â”‚ â”œâ”€â”€ ä¸Šä¸‹æ–‡æ³¨å…¥
â”‚             â”‚ â””â”€â”€ æŒ‡æ ‡é‡‡é›†
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 6. è®¿é—®æ—¥å¿—
â”‚ Logging     â”‚ â”œâ”€â”€ è¯·æ±‚è®°å½•
â”‚ Middleware  â”‚ â”œâ”€â”€ å‚æ•°è®°å½•
â”‚             â”‚ â””â”€â”€ å“åº”è®°å½•
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 7. å›½é™…åŒ–
â”‚ I18n        â”‚ â”œâ”€â”€ è¯­è¨€æ£€æµ‹
â”‚ Middleware  â”‚ â”œâ”€â”€ æ¶ˆæ¯ç¿»è¯‘
â”‚             â”‚ â””â”€â”€ å“åº”æœ¬åœ°åŒ–
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 8. ä¸šåŠ¡å¤„ç†
â”‚ Business    â”‚ â”œâ”€â”€ è·¯ç”±åŒ¹é…
â”‚ Handler     â”‚ â”œâ”€â”€ å‚æ•°éªŒè¯
â”‚             â”‚ â””â”€â”€ é€»è¾‘æ‰§è¡Œ
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
Response Out (ç»è¿‡ä¸­é—´ä»¶é€†å‘å¤„ç†)
```

## ğŸ›ï¸ æ‰©å±•æœºåˆ¶

### 1. è‡ªå®šä¹‰ä¸­é—´ä»¶

```go
// å®šä¹‰ä¸­é—´ä»¶æ¥å£
type HTTPMiddleware func(http.Handler) http.Handler

// å®ç°è‡ªå®šä¹‰ä¸­é—´ä»¶
func CustomMiddleware(config *CustomConfig) HTTPMiddleware {
    return func(next http.Handler) http.Handler {
        return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
            // å‰ç½®å¤„ç†é€»è¾‘
            
            // è°ƒç”¨ä¸‹ä¸€ä¸ªä¸­é—´ä»¶
            next.ServeHTTP(w, r)
            
            // åç½®å¤„ç†é€»è¾‘
        })
    }
}

// æ³¨å†Œä¸­é—´ä»¶
gw.RegisterMiddleware(CustomMiddleware(customConfig))
```

### 2. è‡ªå®šä¹‰å¥åº·æ£€æŸ¥

```go
// å®ç°å¥åº·æ£€æŸ¥æ¥å£
type CustomHealthChecker struct {
    name string
}

func (c *CustomHealthChecker) Name() string {
    return c.name
}

func (c *CustomHealthChecker) Check(ctx context.Context) error {
    // å®ç°å…·ä½“æ£€æŸ¥é€»è¾‘
    return nil
}

// æ³¨å†Œå¥åº·æ£€æŸ¥
gw.RegisterHealthChecker(&CustomHealthChecker{name: "custom"})
```

### 3. è‡ªå®šä¹‰é…ç½®æº

```go
// å®ç°é…ç½®æºæ¥å£
type CustomConfigSource struct {
    endpoint string
}

func (c *CustomConfigSource) Load() (*config.GatewayConfig, error) {
    // ä»è‡ªå®šä¹‰æºåŠ è½½é…ç½®
    return cfg, nil
}

func (c *CustomConfigSource) Watch() <-chan *config.GatewayConfig {
    // ç›‘å¬é…ç½®å˜åŒ–
    return ch
}

// æ³¨å†Œé…ç½®æº
configManager.RegisterSource(&CustomConfigSource{endpoint: "http://config-server"})
```

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–

### 1. å†…å­˜ä¼˜åŒ–

- **å¯¹è±¡æ± åŒ–** - å¤ç”¨HTTPè¯·æ±‚/å“åº”å¯¹è±¡
- **é›¶æ‹·è´** - ä½¿ç”¨ bytes.Buffer å‡å°‘å†…å­˜åˆ†é…
- **å†…å­˜æ± ** - é¢„åˆ†é…å¤§å¯¹è±¡ï¼Œå‡å°‘GCå‹åŠ›

### 2. å¹¶å‘ä¼˜åŒ–

- **Goroutine æ± ** - é™åˆ¶å¹¶å‘æ•°é‡ï¼Œé˜²æ­¢èµ„æºè€—å°½
- **è¿æ¥æ± ** - å¤ç”¨æ•°æ®åº“/Redisè¿æ¥
- **å¼‚æ­¥å¤„ç†** - æ—¥å¿—ã€ç›‘æ§æ•°æ®å¼‚æ­¥å†™å…¥

### 3. ç½‘ç»œä¼˜åŒ–

- **HTTP/2** - æ”¯æŒå¤šè·¯å¤ç”¨
- **gRPC Stream** - æµå¼ä¼ è¾“å¤§æ•°æ®
- **å‹ç¼©** - Gzip å“åº”å‹ç¼©

### 4. ç¼“å­˜ç­–ç•¥

- **å“åº”ç¼“å­˜** - HTTP å±‚ç¼“å­˜é¢‘ç¹è¯·æ±‚
- **é…ç½®ç¼“å­˜** - å†…å­˜ç¼“å­˜é…ç½®æ•°æ®
- **è¿æ¥ç¼“å­˜** - é•¿è¿æ¥å¤ç”¨

## ğŸ› ï¸ å¼€å‘è°ƒè¯•

### 1. æœ¬åœ°å¼€å‘

```bash
# å¯ç”¨è°ƒè¯•æ¨¡å¼
export GATEWAY_DEBUG=true
export GATEWAY_LOG_LEVEL=debug

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
go run cmd/gateway/main.go -config config-dev.yaml
```

### 2. æ€§èƒ½åˆ†æ

```bash
# å¯ç”¨ pprof
curl http://localhost:8080/debug/pprof/

# CPU åˆ†æ
go tool pprof http://localhost:8080/debug/pprof/profile

# å†…å­˜åˆ†æ
go tool pprof http://localhost:8080/debug/pprof/heap

# Goroutine åˆ†æ
go tool pprof http://localhost:8080/debug/pprof/goroutine
```

### 3. ç›‘æ§æŒ‡æ ‡

```bash
# Prometheus æŒ‡æ ‡
curl http://localhost:8080/metrics

# å¥åº·æ£€æŸ¥
curl http://localhost:8080/health

# ç‰ˆæœ¬ä¿¡æ¯
curl http://localhost:8080/version
```

## ğŸ“ˆ æœ€ä½³å®è·µ

### 1. é…ç½®ç®¡ç†

- âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡è¦†ç›–æ•æ„Ÿé…ç½®
- âœ… åˆ†ç¯å¢ƒç®¡ç†é…ç½®æ–‡ä»¶
- âœ… å¯ç”¨é…ç½®çƒ­é‡è½½
- âŒ é¿å…åœ¨ä»£ç ä¸­ç¡¬ç¼–ç é…ç½®

### 2. ä¸­é—´ä»¶è®¾è®¡

- âœ… ä¿æŒä¸­é—´ä»¶çš„å•ä¸€èŒè´£
- âœ… æ­£ç¡®å¤„ç†é”™è¯¯å’Œå¼‚å¸¸
- âœ… ä½¿ç”¨ä¸Šä¸‹æ–‡ä¼ é€’æ•°æ®
- âŒ é¿å…åœ¨ä¸­é—´ä»¶ä¸­é˜»å¡æ“ä½œ

### 3. æœåŠ¡æ³¨å†Œ

- âœ… åˆç†è®¾è®¡ API ç»“æ„
- âœ… ä½¿ç”¨ Protocol Buffers å®šä¹‰æ¥å£
- âœ… å®ç°ä¼˜é›…çš„é”™è¯¯å¤„ç†
- âŒ é¿å…åœ¨å¤„ç†å™¨ä¸­ç›´æ¥æ“ä½œæ•°æ®åº“

### 4. ç›‘æ§è¿ç»´

- âœ… é…ç½®å…³é”®æŒ‡æ ‡å‘Šè­¦
- âœ… ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—
- âœ… å®šæœŸæ£€æŸ¥å¥åº·çŠ¶æ€
- âŒ é¿å…è®°å½•æ•æ„Ÿä¿¡æ¯

---

æœ¬æ–‡æ¡£å°†éšç€æ¡†æ¶çš„å‘å±•æŒç»­æ›´æ–°ï¼Œå¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œè¯·æäº¤ [GitHub Issues](https://github.com/kamalyes/go-rpc-gateway/issues)ã€‚
