# go-rpc-gateway 生产环境配置
# 基于 go-config v0.7.1 标准格式

name: "go-rpc-gateway 生产版"
enabled: true
debug: false
version: "v1.0.0"
environment: "production"

# HTTP服务器配置
http:
  host: "0.0.0.0"
  port: 80
  read-timeout: 30
  write-timeout: 30
  idle-timeout: 300

# gRPC服务器配置  
grpc:
  host: "0.0.0.0"
  port: 443
  max-recv-msg-size: 4194304
  max-send-msg-size: 4194304

# 日志配置
logging:
  level: "info"
  format: "json"
  output: "file"
  file-path: "/var/log/gateway/app.log"
  
# 健康检查配置
health-check:
  enabled: true
  path: "/health"

# JSON序列化配置
json:
  use-proto-names: true      # 使用proto字段名(snake_case)，如 snake_case 而不是 snakeCase
  emit-unpopulated: true     # 输出所有字段，包括零值字段
  discard-unknown: true      # 反序列化时忽略未知字段
  
# ===========================================
# 中间件配置 - 生产环境优化
# ===========================================
middleware:
  module-name: middleware
  enabled: true
  
  # 日志中间件
  logging:
    module-name: logging
    enabled: true
    level: info
    format: json
    output: file
    file-path: "/var/log/gateway/app.log"
    include-caller: false
    include-stack: false
    
  # 恢复中间件
  recovery:
    module-name: recovery
    enabled: true
    debug: false
    enable-stack-trace: false
    disable-print-stack: true
    
  # 链路追踪中间件 - 生产环境优化
  tracing:
    module-name: tracing
    enabled: true
    service-name: "go-rpc-gateway-prod"
    service-version: "v1.0.0"
    environment: "production"
    exporter-type: "otlp"  # 生产环境推荐OTLP
    exporter-endpoint: "http://jaeger-collector:4317"
    sample-rate: 0.05  # 生产环境低采样率
    sampler-type: "probability"
    sampler-probability: 0.05  # 5%采样率
    headers:
      - "Authorization"
      - "X-Request-ID"
    attributes:
      deployment.environment: "production"
      service.namespace: "gateway"
      
  # 指标中间件 - 生产环境监控
  metrics:
    module-name: metrics
    enabled: true
    path: "/metrics"
    namespace: "gateway_prod"
    subsystem: "http"
    skip-paths:
      - "/health"
      - "/metrics"
    buckets: [0.005, 0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 1.0, 2.5, 5.0, 10.0]
    request-count: true
    duration: true
    request-size: false  # 生产环境可关闭以减少开销
    response-size: false
    
  # 请求ID中间件
  request-id:
    module-name: requestid
    enabled: true
    header-name: "X-Request-ID"
    generator: "uuid"
    
  # 国际化中间件
  i18n:
    module-name: i18n
    enabled: true
    default-language: "zh"
    supported-languages: ["zh", "en"]
    language-header: "Accept-Language"
    language-param: "lang"
    detection-order: ["header", "query", "default"]
    enable-fallback: true
    locales-path: "locales"
    
  # PProf - 生产环境关闭
  pprof:
    module-name: pprof
    enabled: false

# ===========================================
# CORS跨域配置 - 生产环境安全
# ===========================================
cors:
  module-name: cors
  enabled: true
  allow-origins: ["https://yourdomain.com"]
  allow-methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
  allow-headers: 
    - "Content-Type"
    - "Authorization"
    - "X-Request-ID"
  expose-headers:
    - "X-Request-ID"
  allow-credentials: true
  max-age: 86400
  
# ===========================================
# 限流配置 - 生产环境保护
# ===========================================
rate-limit:
  module-name: rate_limit
  enabled: true
  requests-per-second: 2000
  burst-size: 4000
  cleanup-interval: "5m"
  
# ===========================================
# 监控配置 - 生产环境
# ===========================================
monitoring:
  module-name: monitoring
  enabled: true
  metrics-enabled: true
  tracing-enabled: true
  profiling-enabled: false
  health-check-enabled: true
  
# Swagger文档配置（生产环境关闭）
swagger:
  module-name: swagger
  enabled: false